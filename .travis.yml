language: android
components:
  - build-tools-26.0.3
  - android-26
  - extra-google-google_play_services
  - extra-google-m2repository
  - extra-android-m2repository
  - addon-google_apis-google-26
licenses:
  - 'android-sdk-preview-license-52d11cd2'
  - 'android-sdk-license-.+'
  - 'google-gdk-license-.+'
jdk: oraclejdk8
cache: yarn
before_install:
- nvm install 8.11.3
- node --version
- curl -o- -L https://yarnpkg.com/install.sh | bash
- export PATH=$HOME/.yarn/bin:$PATH


addons: 
  apt:
  sources:
  - sourceline:  'deb https://dl.yarnpkg.com/debian/ stable main'
    key_url: 'https://dl.yarnpkg.com/debian/pubkey.gpg'
    packages:
      - yarn


install:
- yarn

script:
- yarn run lint

before_deploy:
- bash ci/.travis-android-license-bugfix.sh
- echo y | android update sdk --no-ui --all --filter build-tools-26.0.1
- echo y | android update sdk -u -a -t tools
- echo y | android update sdk -u -a -t platform-tools
- echo y | android update sdk -u -a -t build-tools-26.0.1
- echo y | android update sdk -u -a -t build-tools-26.0.3
- echo y | android update sdk -u -a -t android-23
- echo y | android update sdk -u -a -t android-26
- echo y | android update sdk -u -a -t extra-google-m2repository
- echo y | android update sdk -u -a -t extra-android-m2repository
- cd android && ./gradlew assembleRelease

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: c4f9cd8d7532bc9d4d017c18ae4c192436550454
  file: $TRAVIS_BUILD_DIR/android/app/build/outputs/apk/app-release.apk
  on:
    repo: haitaodesign/LeeCCApp
    tags: true